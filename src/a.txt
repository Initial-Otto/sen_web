-- 用户表优化：建议使用数字ID作为主键
CREATE TABLE 用户 (
    用户编号 INT AUTO_INCREMENT PRIMARY KEY,  -- 新增数字主键，更高效
    账号 VARCHAR(50) UNIQUE NOT NULL,        -- 保持唯一性约束
    邮箱 VARCHAR(100)
    用户名 VARCHAR(50) NOT NULL,
    密码哈希值 CHAR(60) NOT NULL,           -- BCrypt哈希固定60字符
    经验值 INT DEFAULT 0,
    等级 INT DEFAULT 0,
    头像路径 VARCHAR(255),
    注册时间 DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_账号(账号),
    INDEX idx_邮箱(邮箱)
);

-- 帖子表优化：调整一些字段类型和索引
CREATE TABLE 帖子 (
    发帖编号 INT AUTO_INCREMENT PRIMARY KEY,
    用户编号 INT NOT NULL,                    -- 改为数字外键
    发帖时间 DATETIME DEFAULT CURRENT_TIMESTAMP,
    最后回复时间 DATETIME,
    标题 VARCHAR(200) NOT NULL,
    版块编号 INT COMMENT '新增：帖子分类',
    帖子状态 TINYINT DEFAULT 1 COMMENT '1-正常 2-置顶 3-删除',
    FOREIGN KEY (用户编号) REFERENCES 用户(用户编号),
    INDEX idx_用户编号(用户编号),
    INDEX idx_发帖时间(发帖时间),
    INDEX idx_最后回复时间(最后回复时间)       -- 按最新回复排序
    INDEX idx_版块状态(版块编号)
);

-- 帖子内容表
CREATE TABLE 帖子内容 (
    发帖编号 INT PRIMARY KEY,
    文本内容 LONGTEXT,                       -- 改为LONGTEXT支持更大内容
    图片路径 VARCHAR(255) COMMENT '单个图片路径'
    FULLTEXT INDEX idx_全文搜索(文本内容),    -- 全文搜索索引
    FOREIGN KEY (发帖编号) REFERENCES 帖子(发帖编号) ON DELETE CASCADE
);

-- 评论表优化
CREATE TABLE 评论 (
    评论编号 INT AUTO_INCREMENT PRIMARY KEY,
    发帖编号 INT NOT NULL,
    用户编号 INT NOT NULL,
    评论时间 DATETIME DEFAULT CURRENT_TIMESTAMP,
    楼层编号 INT COMMENT '在帖子中的楼层号',
    文本内容 TEXT,
    FOREIGN KEY (发帖编号) REFERENCES 帖子(发帖编号),
    FOREIGN KEY (用户编号) REFERENCES 用户(用户编号),
    INDEX idx_发帖编号(发帖编号),
    INDEX idx_时间排序(发帖编号, 评论时间)    -- 按时间查看评论
);

-- 用户互动表（只有收藏）


CREATE TABLE 用户收藏帖子 (
    用户编号 INT,
    发帖编号 INT,
    收藏时间 DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (用户编号, 发帖编号),
    FOREIGN KEY (用户编号) REFERENCES 用户(用户编号) ON DELETE CASCADE,
        FOREIGN KEY (发帖编号) REFERENCES 帖子(发帖编号) ON DELETE CASCADE,
    INDEX idx_用户收藏(用户编号, 收藏时间)
);